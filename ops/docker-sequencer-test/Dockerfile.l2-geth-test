# Build Geth for Sequencer Test
# Build context should be bitget/ (parent of morph)
FROM ghcr.io/morph-l2/go-ubuntu-builder:go-1.24-ubuntu AS builder

# Copy local go-ethereum (not submodule)
COPY ./go-ethereum /go-ethereum
WORKDIR /go-ethereum

# Build geth
RUN go run build/ci.go install ./cmd/geth

# Runtime stage
FROM ghcr.io/morph-l2/go-ubuntu-builder:go-1.24-ubuntu

RUN apt-get -qq update && apt-get -qq install -y --no-install-recommends \
    ca-certificates bash curl \
    && rm -rf /var/lib/apt/lists/*

COPY --from=builder /go-ethereum/build/bin/geth /usr/local/bin/
COPY ./morph/ops/docker-sequencer-test/entrypoint-l2.sh /entrypoint.sh

VOLUME ["/db"]

ENTRYPOINT ["/bin/bash", "/entrypoint.sh"]

EXPOSE 8545 8546 8551 30303 30303/udp
